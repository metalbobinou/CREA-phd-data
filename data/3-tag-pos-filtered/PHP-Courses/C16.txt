programmation
web
:
php
avec
l'aimable
autorisation
de
jérôme
cutrona

php:
langage
de
script
pour
web

qu’est-ce
php
?







langage
de
script.
utiliser
coter
serveur
acronyme
récursif
:
php:
hypertext
preprocessor
créer
en
1994-1995
par
rasmus
lerdorf
extension
utiliser
sur
serveur
web
(33%)
langage
multi
plate-forme
(unix
/
windows…)
open
source
verser
actuelles
(source
nexen.net)
:

php4
(52%
en
octobre
2008)

php5
(48%
en
octobre
2008)
10:11:04
programmation
web
2012-2013
2

utilité
utilisation
de
php

création
de
page
html
«
dynamiques
»,
fabriquer
à
volée,
construire
à
demande

interface
entre
serveur
web
base
de
donnée

création
d’applications
web
10:11:04
programmation
web
2012-2013
3

principales
fonctionnalité
de
php









manipulation
de
chaîne
tableau
calendrier
/
date
/
heure
fonction
mathématiques
accès
système
de
fichier
manipulation
d’images
http
/
ftp
/
imap
base
de
donnée
(oracle,
mysql,
…)
xml
…
10:11:05
programmation
web
2012-2013
4

fonctionnement
de
php
requêter
http
client
(((port
hello.php
))
rendre
localisation
connexion
exécution
fermeture
graphique
de
sur
de
code
code
connexion
serveur
ressource
php
php
donner
dans
envoi
résultat
client
localisation
rendre
exécution
fermeture
connexion
requêter
graphique
http
de
sur
de
code
code
connexion
serveur
ressource
client
php
php
données
(port
hello.php
dans80)
80)
fichier
fichier
envoi
résultat
client
==
réponse
réponse
http
http
client
client
get
navigateur
get
/hello.php
/hello.php
http/1.0
http/1.0
réseau
•html
réseau
•javascript
•css
protocole
protocole
http
http
exécution
exécution
d’un
d’un
programme
programmer
sur
sur
serveur
serveur
construction
de
réponse
construction
de
réponse
<<html
>
html>
<<head
head>>
serveur
serveur
<<title
title>>hello
hello</
</title
title>>
</
</head
head>>
serveur
web
.html
<<body
body>>hello
hello
world
world</
</body
body>>
.php
</
</html
html>>
.jpg
moduler
php
mysql
10:11:05
<?php
<?php
echo
hello.php
echo
<<<
<<<html
html
hello.php
<<html
>
html>
<<head
head>>
<<title
title>>hello
hello</
</title
title>>
</
</head
head>>
<<body
body>>hello
hello
world
world</
</body
body>>
</
</html
html>>
html;
html;
programmation
web
2012-2013
5

fonctionnement
de
php
client

serveur
1.
2.
3.
4.
connexion
tcp
sur
serveur
(port
80)
requête
http
client
(mon_fichier.php)
localisation
de
ressource
exécution
code
php
envoi
résultat
de
l’exécution
client
=
réponse
http
6.
fermeture
de
connexion
@ord@
rendre
graphique
donnée
(html,
image,
…)
10:11:05
programmation
web
2012-2013
6

programme
en
php
délimitation
code
php
dans
fichier
.php
:

<?php
coder
php
?>
fermeture
fermeture
optionnelle
optionnelle

<script
language="php">
confusion
confusion
avec
avec
javascript
javascript


àà
bannir
bannir!!!!
!!!!
coder
php
</script>


<?
coder
php
?>
<%
code
php
%>
10:11:06
dépendre
dépendre
de
de
configuration
configuration
short_open_tag
short_open_tag
serveur
serveur
asp_tags
asp_tags


àà
bannir
bannir!!!!
!!!!
programmation
web
2012-2013
7

eléments
de
syntaxe
php

syntaxe
de
php
ressembler
à
de
famille
"c"
(c,
c++,
java,
…)

instruction
terminer
par
";"

commentaires:
/*
jusqu’au
prochain
*/
//
jusqu’à
fin
de
ligne
#
jusqu’à
fin
de
ligne
10:11:06
programmation
web
2012-2013
8

les
variables
type
de
donnée

identificateur
commencer
par
"$"

affectation
être
réaliser
grâce
à
"="

numérique
entier:
12
réel:
1.54

chaîne:
"hello"
’bonjour’

booléen:
true,
false
(php
4)

tableau:
$tab[2]=12

objet
(php4,
php5)

ressourcer

null

type
d’une
variable
être
dynamique
être
déterminer
par
valeur
être
affecter
10:11:06
programmation
web
2012-2013
9

typage
faible.
exemple
//
de
déclaration
de
variable
$test
=
1.5
;
//
réel
$test
=
12
;
//
entier
$test
=
array()
;
//
tableau
$test
=
"10"
;
//
chaîne
echo
$test
;
//
10
10:11:07
programmation
web
2012-2013
10

typage
automatique.
exemple
$nombre1
$nombre2
$chaine1
$chaine2
=
=
=
=
1.5
;
12
;
"10"
;
'coucou'
;
//
//
//
//
réel
entier
chaîne
chaîner
$total
=
$nombre1
+
$nombre2
+
$chaine1
+
$chaine2
;
1.5
1.5
12
12
"10"
"10"
13.5
13.5
10
10
23.5
23.5
echo
$total
;
//
23.5
réel
10:11:07
'coucou'
'coucou'
programmation
web
2012-2013
00
23.5
23.5
11

les
chaîne
de
caractère
substitution
de
variables
dans
chaîne

guillemet
simples


$a='chaîne'
;
$b='voici
$a';

guillemet
doubles


$a="chaîne"
;
$b="voici
$a";

syntaxe
heredoc


10:11:07
$a="chaîne"
;
$b=<<<marque_de_fin
$a
sur
deux
ligne
;-)
marque_de_fin;
chaîne
chaîner
un
$a
$a
chaîne
chaîner
un
chaîne
chaîner
chaîne
chaîner
un
chaîne
chaîner
sur
sur
deux
deux
ligne
ligne
;-)
;-)
programmation
web
2012-2013
12

concaténation
de
chaîne


permettre
d’assembler
chaîne
réaliser
grâce
à
l’opérateur
point
:
.
"bonjour
"
.
"marcel"

valoir
"bonjour
marcel"
$nb
=
6*2
;
"acheter
"
.
$nb

valoir
10:11:08
.
"
oeufs"
"acheter
12
oeufs"
programmation
web
2012-2013
13

la
commander
echo

permettre
d’envoyer
texte
navigateur
client
(«
écrire
»
page
format
html
résulter
de
l’interprétation
de
php)


echo
"bonjour"
;
$nom="marcel"
;
echo
"bonjour
$nom"
;

généralement,
permettre
d’envoyer
octet
navigateur
client



10:11:08
ficher
html,
xml,
css,
javascript,
…
donner
d'une
imager
contenir
d'un
ficher
pdf,
flash,
etc.
programmation
web
2012-2013
14

hello
world!
!
interprétation
interprétation
code
coder
php
php
sur
sur
serveur
serveur
<?php
serveur
navigateur
<?php
transmission
résultat
client
transmission
résultat
client
$$debut
debut
==
<<<
<<<html
html
<<html
html>>
<<head
head>>
<<title
title>>hello
hello</
</title
title>>
</
</head
head>>
<<body
body>>\n
\n
html
html;;
$$corps
corps
==
""hello
hello
world!
!
world!
!\n
\n";
";
$$fin
==
<<<
fin
<<<html
html
</
</body
body>>
</
</html
html>>
html
html;;
/*
/*
envoi
envoi
client
client
*/
*/
echo
echo
$$debut
debut.$
.$corps
corps.$
.$fin
fin
;;
<<html
html>>
<<head
head>>
<<title
title>>hello
hello</
</title
title>>
</
</head
head>>
<<body
body>>
hello
hello
world!
!
world!
!
</
</body
body>>
</
</html
html>>
impossible
impossible
de
de
voir
voir
code
coder
php
php
depuis
depuis
navigateur
navigateur!!
!!
!!
!!
10:11:08
programmation
web
2012-2013
15

les
opérateur
arithmétiques
$b
somme
$b
différence
$b
multiplication
$a
+
*
/
$b
division
$a
%
$b
modulo
(reste
de
division
entière)
$a
$a
$a
10:11:09
programmation
web
2012-2013
16

les
opérateur
d’in-
de
dé-crémentation
pré-
post-fixés
$a++
++$a
$a--
--$a
10:11:09
retourne
valeur
de
$a
augmenter
valeur
de
$a
de
1
augmenter
valeur
de
$a
de
1
retourner
nouvelle
valeur
de
$a
retourner
valeur
de
$a
diminuer
valeur
de
$a
de
1
diminuer
valeur
de
$a
de
1
retourner
nouvelle
valeur
de
$a
programmation
web
2012-2013
17

les
opérateur
de
comparaison
==
$b
$a!
!=
$b
$a
<
$b
$a
>
$b
$a
<=
$b
$a
>=
$b
$a
===
$b
$a!
!==
$b
$a
10:11:09
vrai
égalité
entre
valeur
de
$a
$b
vrai
différence
entre
valeur
de
$a
$b
vrai
$a
inférieur
à
$b
vrai
$a
supérieur
à
$b
vrai
$a
inférieur
égal
à
$b
vrai
$a
supérieur
égal
à
$b
vrai
$a
$b
identiques
(valeur
type)
vrai
$a
$b
différents
(valeur
type)
programmation
web
2012-2013
18

les
opérateur
logiques
and
[expr2]
[expr1]
&&
[expr2]
[expr1]
[expr2]
[expr1]
||
[expr2]
[expr1]
[expr1]
!
!
10:11:10
xor
vrai
[expr1]
[expr2]
être
vraies
vrai
[expr1]
[expr2]
être
vraies
vrai
[expr1]
[expr2]
être
vraies
[expr2]
deux
[expr1]
vrai
[expr1]
être
vraie
programmation
web
2012-2013
19

les
opérateur
sur
bit
$a
$a
$a
&
|
^
$b
binaire
$b
binaire
$b
xor
binaire
~
$a
$a
<<
$b
$a
>>
$b
10:11:10
inversion
bit
à
bit
$a
décaler
à
gauche
de
$b
rang
$a
décaler
à
droite
de
$b
rang
programmation
web
2012-2013
20

précédence
opérateur
10:11:10
programmation
web
2012-2013
21

précédence
opérateur
en
en
cas
cas
de
de
doute,
doute,
utiliser
utiliser
parenthèse
parenthèse
;-)
;-)
10:11:11
programmation
web
2012-2013
22

structure
de
contrôle
si…alors…sinon…
if
(condition)
{
/*
bloc
d’instructions
exécuter
condition
être
vraie
*/
}
[else
{
/*
bloc
d’instructions
exécuter
condition
être
fausse
*/
}]
10:11:11
programmation
web
2012-2013
23

structure
de
contrôle
que…
faire…
while
(condition)
{
/*
bloc
d’instructions
répéter
condition
être
vraie
*/
}
do
{
/*
bloc
d’instructions
exécuter
fois
répéter
condition
être
vraie
*/
}
while
(condition)
;
10:11:11
programmation
web
2012-2013
24

structure
de
contrôle
que…
faire…
for(avant;
condition;
fin_chaque_itération)
{
/*
bloc
d’instructions
répéter
condition
être
vraie
*/
}
équivalent
à:
avant
;
while
(condition)
{
/*
bloc
d’instructions
répéter
condition
être
vraie
*/
fin_chaque_itération
;
}
10:11:12
programmation
web
2012-2013
25

structure
de
contrôle
switch…
switch
(val)
{
caser
v1:
instruction
caser
v2:
instruction
}
exécuter
val==v1
exécuter
val==v2
val==v1
…
default:
instruction
dans
cas
10:11:12
programmation
web
2012-2013
26

l’instruction
break
permettre
de
sortir
d’une
structure
de
contrôle
switch
(val)
{
caser
v1:
instruction
exécuter
val==v1
break
;
/*
sortir
switch
val==v1
*/
caser
v2:
instruction
exécuter
val==v2
val==v1
break
;
/*
sortir
switch
val==v2
*/
…
default:
instruction
exécuter
dans
cas
val!
!=v1
val!
!=v2
}
10:11:12
programmation
web
2012-2013
27

les
tableau

création
/
initialisation:
$tab1=array(12,
"fraise",
2.5)
;
$tab2[]
$tab2[]
$tab2[]
=
=
=
12
;
"fraise"
;
2.5
;
$tab3[0]
=
12
;
$tab3[1]
=
"fraise"
;
$tab3[2]
=
2.5
;
10:11:13
programmation
web
2012-2013
clé
valeur
0
12
1
"fraise"
2
2.5
28

les
tableau
«
à
trou
»

élément
tableau
être
forcement
d’indices
consécutifs
:
$tab4[0]
$tab4[1]
$tab4[2]
$tab4[5]
=
=
=
=
12
;
"fraise"
;
2.5
;
"el5"
;
clé
valeur
0
12
1
"fraise"
2
3
4
5
2.5
"el5"

parcourir
de
tableau
?
10:11:13
programmation
web
2012-2013
29

les
tableau
«
à
trou
»
(suite)
4
parcours
classique
:
for
($i=0;
$i
<
sizeof($tab4);
$i++)
{
echo
"tab4[$i]:
"
.
$tab4[$i]
.
"<br>\n";
}
clé
valeur
?
10:11:13
programmation
web
2012-2013
0
1
12
"fraise"
2
3
2.5
4
5
"el5"
30

structure
de
contrôle
pour
chaque…
foreach
($tableau
avoir
$element)
{
/*
bloc
d’instructions
répéter
pour
élément
de
$tableau
*/
/*
élément
de
$tableau
être
accessible
grâce
à
$element
*/
}
10:11:14
programmation
web
2012-2013
31

parcours
de
tableau
:
foreach
php
…
$tab4[0]
=
12
;
$tab4[1]
=
"fraise"
;
$tab4[2]
=
2.5
;
$tab4[5]
=
"el5"
;
foreach($tab4
avoir
$v)
{
echo
"val:
$v<br>\n";
}
…
10:11:14
html
…
val:12<br>\n
val:fraise<br>\n
val:2.5<br>\n
val:el5<br>\n
…
programmation
web
2012-2013
navigateur
32

tableaux
associatifs

tableau
l’accès
élément
n’est
réaliser
grâce
à
index
(0,1,…)
grâce
à
clé
de
type
entier
chaîne.

exemple
de
clés:
$tab['un']
=
12
;
$tab[205]
=
"bonjour"
;
$tab["la

création
valeur"]
$tab
=
array(cle1
=>
cle2
=>
=
3.0
;
val1,
val2,
…);
10:11:14
programmation
web
2012-2013
33

tableaux
associatifs
-
exemple
$tab5['un']
$tab5['trois']
$tab5["deux"]
$tab5[42]
=
=
=
=
12
;
"fraise"
;
2.5
;
"el5"
;
clé
"un"
10:11:15
=>
=>
=>
=>
12
"trois"
"fraise"
"deux"
2.5
42
$tab6
=
array('un'
'trois'
"deux"
42
valeur
"el5"
12,
"fraise",
2.5,
"el5")
;
programmation
web
2012-2013
34

structure
de
contrôle
pour
chaque…
foreach($tableau
avoir
$cle
=>
$element)
{
/*
bloc
d’instructions
répéter
pour
élément
de
$tableau
*/
/*
élément
de
$tableau
être
accessible
grâce
à
$element
*/
/*
clé
d’accès
à
élément
être
donner
par
$cle
*/
}
10:11:15
programmation
web
2012-2013
35

parcours
de
tableau
<?php
<?php
$$html
html
==
<<<
<<<html
html
<<html
html>>
<<head
head><
><title
title>>foreach
foreach
clé
clé</
</title
title>>
</
</head
head>>
<<body
body>>
html
html;;
$$tab6
=>
tab6
==
array
array((''un
un''
=>
12
12,,
''deux
=>
deux''
=>
""fraise
fraise",
",
""trois
trois""
=>
=>
2.5
2.5,,
""quatre
quatre""
=>
=>
""el5
el5""))
;;
foreach
foreach
(($$tab6
tab6
as
avoir
$$cle
cle
=>
=>
$$val
val))
{{
$$html
html
.=
.=
""tab[
tab[$$cle
cle]:
]:
$$val
val<br>
<br>\n
\n""
;;
}}
echo
echo
$$html
html
..
""</
</body
body>\n</
>\n</html
html>>""
;;
10:11:15
programmation
web
2012-2013
36

exemple
de
génération
de
code
html
<?php
<?php
$$html
html
==
<<<
<<<html
html
<!
!doctype
<!
!doctype
html
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
html>>
<<head
head>>
<<meta
meta
http-equiv
http-equiv=="content-type"
"content-type"
content
content=="text/html;
"text/html;
charset=iso-8859-1"
charset=iso-8859-1">>
<<title
title>boucle</
>boucle</title
title>>
</
</head
head>>
<<body
body>>
html;
html;
for
for
(($$ii==1;
1;
$$ii<<20;
20;
$$ii++
++))
{{
$$html
html
.=
.=
""le
serveur
serveur
compte...
compte...
""
..
$$ii
..
""<br>
<br>\n"
\n"
;;
}}
$$html
html
.=
.=
<<<
<<<html
html
</
body
>
</body>
</
</html
html>>
html;
html;
echo
echo
$$html
html
;;
10:11:16
programmation
web
2012-2013
37

traitement
donnée
de
formulaire

php
permettre
de
traiter
donnée
saisies
grâce
à
formulaire
html
champ
action
formulaire
désigner
page
php
serveur.

après
récupération
par
serveur
web,
donnée
être
contenir
dans
l'une
variables
superglobales
de
type
tableau
associatif
$_get
$_post
(ou
$_request).

valeur
pouvoir
être
trouver
grâce
à
clé
porter
même
nom
champ
formulaire
de
page
html
de
saisie.
10:11:16
programmation
web
2012-2013
38

traitement
donnée
de
formulaire
réseau
réseau
client
client
navigateur
•html
nompers=robert
nompers=robert
•javascript
•css
<<html
html>>
<<head
head>>
serveur
serveur
nompers
<<title
nompers
title>>bonjour
bonjour</
</title
title>>
</
</head
head>>
serveur
web
<?php
<?php
<<body
body>>
$
$html
html
==
<<<
<<<html
html
bonjour
bonjour
robert
robert!!
!!
<
html
>
<html>
</
</body
body>>
<
<head
head><
><title
title>>bonjour
bonjour</
</title
title></
></head
head>>
</
html
</
html>>
php
moduler
<<body
body>>
html
html;;
$$html
html
.=
.=
""bonjour
bonjour
"".$
.$_get
_get[[''nompers
nompers'']]..""!!
!!\n
\n""
;;
echo
echo
$$html
html
..
""</
</body
body>>\n
\n</
</html
html>>""
;;
robert
robert
10:11:17
programmation
web
2012-2013
39

exemple
–
formulaire
html
<!
!doctype
<!
!doctype
html
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
html>>
<<head
head>>
<<title
title>>formulaire
formulaire</
</title
title>>
</
</head
head>>
<<body
body>>
<<form
form
action
action==""valide1.php
valide1.php""
method
method==""get
get"">>
nom:
nom:
<<input
input
type
type==""text
text""
name
name==""nompers
nompers"">>
<<input
input
type
type==""submit
submit""
valoir
value==""envoyer
envoyer"">>
</
</form
form>>
</
</body
body>>
</
</html
html>>
10:11:17
programmation
web
2012-2013
40

exemple
–
traitement
en
php
<?php
<?php
$$html
html
==
<<<
<<<html
html
<!
!doctype
html
<!
!doctype
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
>
html>
<<head
head>>
$$_get
<<title
_get[[''nompers
nompers'']]
title>>validation
validation</
</title
title>>
</
</head
head>>
est-il
définir
??
est-il
définir
<<body
>
body>
html
html;;
if
if
((isset
isset(($$_get
_get[[''nompers
nompers'']]))
))
$$_get
_get[[''nompers
nompers'']]
{{
est-il
est-il
vide
vide
??
if
if
((!!
!!empty
empty(($$_get
_get[[''nompers
nompers'']]))
))
{{
$$html
html
.=
.=
""vous
avoir
avoir
saisir
saisir
''""
.$
.$_get
_get[[''nompers
nompers'']]..""''\n
\n""
;;
}}
else
else
$$html
html
.=
.=
""aucune
valeur
valeur
saisir
saisie\n
\n";
";
}}
else
else
$$html
html
.=
.=
""utilisation
utilisation
incorrecte
incorrecte\n
\n""
;;
echo
echo
$$html
html
..
""</
</body
body>>\n
\n</
</html
html>>""
;;
10:11:17
programmation
web
2012-2013
41

formulaires
contenir
champ
«
select
»
10:11:18
programmation
web
2012-2013
42

formulaires
contenir
champ
«
select
unique»
<!
!doctype
<!
!doctype
html
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
html>>
<<head
head>>
<<title
title>>formulaire
formulaire
de
de
saisie
saisir
fruit
fruits</
</title
title>>
</
</head
head>>
<<body
body>>
<<form
form
action
action==""valide3.php
valide3.php""
method
method==""get
get"">>
choisir
choisir
fruits:
fruits:&nbsp;
&nbsp;
<<select
select
name
name==""sel
sel"">>
<<option
option>>fraise
fraiser
<<option
option>>pomme
pomme
<<option
option>>poire
poirer
envoyer
envoyer
<<option
option>>banane
banane
<<option
option>>cerise
cerise
</
</select
select>>
<<input
input
type
type==""submit
submit""
valoir
value==""envoyer
envoyer"">>
</
</form
form>>
</
</body
body>>
valide3.php?
valide3.php?sel=pomme
sel=pomme
</
html
>
</html>
10:11:18
programmation
web
2012-2013
43

formulaires
contenir
champ
«
select
multiple»
<!
!doctype
html
public
"-//w3c//dtd
html
4.01
transitional//en">
<html>
<head>
<title>formulaire
de
saisie
fruits</title>
</head>
<body>
<form
action="valide3.php"
method="get">
choisir
fruits:&nbsp;
<select
name="sel"
multiple>
<option>fraise
<option>pomme
<option>poire
envoyer
<
option>banane
envoyer
<option>cerise
</select>
<input
type="submit"
value="envoyer">
</form>
valide3.php?
</body>
valide3.php?sel=pomme&sel=poire
sel=pomme&sel=poire
</html>
10:11:18
programmation
web
2012-2013
???
???
44

formulaires
contenir
champ
«
select
multiple»
<html>
<head>
<title>formulaire
de
saisie
fruits</title>
</head>
<body>
<form
action="valide3.php"
method="get">
choisir
fruits:&nbsp;
<select
name="sel[]"
multiple>
<option>fraise
<option>pomme
<option>poire
envoyer
envoyer
<option>banane
<option>cerise
</select>
<input
type="submit"
value="envoyer">
</form>
valide3.php?
valide3.php?sel%5b%5d=pomme&sel%5b%5d=poire
sel%5b%5d=pomme&sel%5b%5d=poire
</body>
valide3.php?
</html>
valide3.php?sel[]=pomme&sel[]=poire
sel[]=pomme&sel[]=poire
10:11:19
programmation
web
2012-2013
45

traitement
donnée
champ
«
select
»
<?php
<?php
$$html
html
==
<<<
<<<html
html
<!
!doctype
<!
!doctype
html
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
html>>
<<head
head>>
<<title
title>>liste
liste
de
de
fruit
fruits</
</title
title>>
$$_get
_get[[‘‘sel
sel'']]
</
head
>
</head>
être
être
un
tableau
tableau
<<body
body>>
html
html;;
if
if
((isset
isset(($$_get
_get[[''sel
sel''])
])
&&
&&!!
!!empty
empty(($$_get
_get[[''sel
sel'']))
]))
{{/*
variable
$_get['sel']
être
définir
/*
variable
$_get['sel']
être
définir
n'est
n'est
vide
vide
*/
*/
foreach
foreach(($$_get
_get[[''sel
sel'']]
as
avoir
$$fruit
fruit))
$$html
html
.=
.=
""vous
avoir
avoir
choisir
choisir
$$fruit
fruit<br>
<br>\n
\n""
;;
}}
else
else
$$html
html
.=
.=
""vous
n'avez
n'avez
choisir
choisir
de
de
fruit
fruit\n
\n""
;;
echo
echo
$$html
html
..
""</
</body
body>>\n
\n</
</html
html>>""
;;
10:11:19
programmation
web
2012-2013
46

résultat
10:11:19
programmation
web
2012-2013
47

formulaires
contenir
champ
«
checkbox
»
10:11:20
programmation
web
2012-2013
48

formulaires
contenir
champ
«
checkbox
»
<!
!doctype
<!
!doctype
html
html
public
public
"-//w3c//dtd
"-//w3c//dtd
html
html
4.01
4.01
transitional//en">
transitional//en">
<<html
html>>
<<head
head>>
<<title
title>>formulaire
formulaire
de
de
saisie
saisir
fruit
fruits</
</title
title>>
</
</head
head>>
<<body
body>>
<<form
form
name
name==""formu
formu""
action
action==""valide3.php
valide3.php""
method
method==""get
get"">>
choisir
choisir
fruit
fruits&nbsp;
&nbsp;:<
:<br
br>>
<<input
input
typer
type==""checkbox
checkbox""
name
name==""sel[]
sel[]""
valoir
value==""fraise
fraise"">fraise<
>fraise<br
br>>
<<input
input
typer
type==""checkbox
checkbox""
name
name==""sel[]
sel[]""
valoir
value==""pomme
pomme""
>pomme
>pomme
<<br
br>>
<<input
input
typer
type==""checkbox
checkbox""
name
name==""sel[]
sel[]""
valoir
value==""poire
poire""
>poire
>poire
<<br
br>>
<<input
input
typer
type==""checkbox
checkbox""
name
name==""sel[]
sel[]""
valoir
value==""banane
banane"">banane<
>banane<br
br>>
<<input
input
typer
type==""checkbox
checkbox""
name
name==""sel[]
sel[]""
valoir
value==""cerise
cerise"">cerise<
>cerise<br
br>>
<<input
input
type
type==""submit
submit""
valoir
value==""envoyer
envoyer"">>
</
</form
form>>
</
</body
body>>
</
</html
html>>
10:11:20
programmation
web
2012-2013
49

résultat
10:11:20
programmation
web
2012-2013
50

références
$a
=
12
;
$b
=
$a
;
$c
=
&$a
;
$b
=
"coucou"
;
$c
=
84
;
echo
"\$a
:
$a\n"
$a
$a
::
84
84
echo
"\$b
:
$b\n"
$b
$b
::
coucou
coucou
echo
"\$c
:
$c\n"
$c
$c
::
84
84
unset($c)
;
$c
=
"hello"
;
10:11:21
$$aa
84
12
12
84
$$bb
""coucou
12
coucou""
$$cc
""hello
hello""
;
;
;
programmation
web
2012-2013
51

fonctions
utilisateur

description
d’une
fonctionnalité
dépendre
de
paramètre
retourner
résultat

définition
function
moyenne($a,$b)
{
return
($a+$b)/2.
;
}

utilisation
$resultat
=
moyenne(2,4)
;
echo
$resultat
;
//
valoir
3
10:11:21
programmation
web
2012-2013
52

fonctions
utilisateur

valeur
de
retour
function
moyenne($a,$b)
{
…
}
typage
typage
faible
faible
de
de
php
php
::
information
information

argument
function
moyenne(
{
…
}
$a,
$b)
typage
typage
faible
faible
de
de
php
php
::
information
information
10:11:22
programmation
web
2012-2013
53

mode
de
passage
argument
(types
natifs)
<?php
function
permutation($x,
$y)
{
echo
"permutation..."
;
$t
=
$x
;
permutation
permutation
impossible
impossible
::
$x
=
$y
;
passage
passage
argument
argument
$y
=
$t
;
fonction
fonction
par
par
valeur
valeur
}
$a
=
12
;
$b
=
210
;
$a
echo
"\$a
=
$a"
;
$a
==
12
12
$b
echo
"\$b
=
$b"
;
$b
==
210
210
permutation...
permutation($a,
$b)
;
permutation...
$a
echo
"\$a
=
$a"
;
$a
==
12
12
$b
echo
"\$b
=
$b"
;
$b
==
210
210
?>
10:11:22
programmation
web
2012-2013
54

mode
de
passage
argument
(types
natifs)
<?php
function
permutation(&$x,
&$y)
{
echo
"permutation..."
;
$t
=
$x
;
$x
=
$y
;
$y
=
$t
;
}
$a
=
12
;
$b
=
210
;
$a
echo
"\$a
=
$a"
;
$a
==
12
12
$b
echo
"\$b
=
$b"
;
$b
==
210
210
permutation...
permutation($a,
$b)
;
permutation...
$a
echo
"\$a
=
$a"
;
$a
==
210
210
$b
echo
"\$b
=
$b"
;
$b
==
12
12
?>
10:11:22
programmation
web
2012-2013
permutation
permutation
réussir
réussir
55

arguments
par
défaut
fonction

valeur
par
défaut
d’un
argument
s’il
n’a
être
définir
de
l’appel
de
fonction
function
bonjour($nom="inconnu")
{
echo
"bonjour
$nom"
;
}

utilisation
bonjour()
;
bonjour
bonjour
inconnu
inconnu
bonjour("marcel")
;
bonjour
bonjour
marcel
marcel
10:11:23
programmation
web
2012-2013
56

définition
de
fonction
utiliser

fonction
être
utiliser
dans
script
php

faire
pour
définir
dans
page
?

utilisation
de
:




include("fichier")
;
require("fichier")
;
include_once("fichier")
;
require_once("fichier")
;

permettre
d’inclure
contenu
de
fichier
dans
script
courir
10:11:23
programmation
web
2012-2013
57

include
require
fichier
fichier
mafonction.php
mafonction.php
<?
function
mafonction($arg)
{
if
(isset($arg))
{
echo
("vrai")
;
}
else
{
echo
("faux")
;
}
}
?>
10:11:23
fichier
fichier
utilisation1.php
utilisation1.php
…
require("mafonction.php")
mafonction(true)
;
…
fichier
fichier
utilisation2.php
utilisation2.php
…
include("mafonction.php")
…
$var=false
;
mafonction($var)
;
…
fichier
fichier
utilisation3.php
utilisation3.php
…
require("mafonction.php")
…
programmation
web
2012-2013
58

définition
de
constantes
<?php
define("ma_constante",
"bonjour
à
tous")
;
nom
nom
valeur
valeur
définition
définition
d'une
d'une
constante
constante
echo
ma_constante
;
?>
utilisation
utilisation
de
de
constante
constante
10:11:24
programmation
web
2012-2013
59

gestion
erreur

dans
cas,
n’est
possible
utile
de
poursuivre
l’exécution
code
php
(variables
définies,
valeur
erronées,
échec
de
connexion,
…)

arrêt
brutal
de
l’exécution
code:


die(message)
exit(message)
envoyer
message
navigateur
terminer
l’exécution
script
courir
10:11:24
programmation
web
2012-2013
60

gestion
erreur
–
(mauvais)
exemple
<?php
php
$html
=
<<<html
<html>
<head>
<title>die-exit</title>
</head>
<body>
html;
if
(!
!isset($val))
{
html
die($html."problèmehtml
val")
;
/*
de
point,
fin
script
*/
}
$html
.=
<<<html
choix:
$val
</body>
</html>
10:11:24
<html>
html
<head>
<title>die-exit</title>
</head>
<body>
problème
val
valide
valide…
…
navigateur
problème
val
programmation
web
2012-2013
61

gestion
de
l'affichage
erreur

int
error_reporting
(
[int
level]
)
débogage
constante
ancien
ancien
niveau
niveau
d'erreur
d'erreur
e_error
e_warning
sur
sur
un
serveur
serveur
en
en
e_parse
production,
production,
e_notice
erreur
erreur
afficher
afficher
e_core_error
donner
donner
indice
indice
sur
sur
e_core_warnin
script
script
rendre
rendre
site
g
site
vulnérable
vulnérable
e_compile_err
php.ini
php.ini
display_errors
display_errors
boolean
boolean
e_compile_war
ning
programmation
web
2012-2013
10:11:24
62

opérateur
de
contrôle
d'erreur
$v
=
file("dummy.txt")
die("problème
de
fichier
fichier
absent
absent
lecture")
;
warning
warning::
file(dummy.txt):
file(dummy.txt):
failed
failed
to
to
open
open
stream:
stream:
no
no
such
such
filer
file
or
directory
directory
in
in
dummy.php
dummy.php
line
line
68
68
problème
problème
de
de
lecture
lecture
$v
=
@file("dummy.txt")
or
die("problème
de
lecture")
;
problème
problème
de
de
lecture
lecture
10:11:25
programmation
web
2012-2013
63

développement
objet

définition
de
brique
logicielles
représenter
concept,
idée
entité
interaction
:
objet

objet
être
structure
de
donner
comprendre
fonctionnalité
de
traitement
donnée

l’objet
être
voir
travers
de
spécification

concept
associer
être
:

encapsulation

héritage

polymorphisme
10:11:29
programmation
web
2011-2012
1

classe

classe
définir
modèle,
moule,
à
partir




objet
de
classe
être
créer
classe
décrire
donnée
internes
fonctionnalité
objet
classe
être
vision
«
inerte
»,
recette
de
cuisine,
viser
à
décrire
structure
comportement
objet
être
créer
construction
d’un
objet
à
partir
de
classe
génératrice
s’appelle
instanciation
objets,
entité
«
vivantes
»
en
mémoire,
être
instance
de
classe
10:11:29
programmation
web
2011-2012
2

instanciation

classe
être
description
«
inerte
»

objet
devoir
être
instanciés
à
partir
de
classe
génératrice
pour
exister
devenir
fonctionnels

exemple
:
classe
animal
$bambi
=
new
animal()
;
$scrat
=
new
animal()
;
$melman
=
new
animal()
;
10:11:29
programmation
web
2011-2012
3

encapsulation

procédé
consister
à
rassembler
donnée
traitement
sein
objet

l’implémentation
interne
objet
être
cacher

objet
être
voir
à
travers
spécification

donnée
internes
fonctionnalité
posséder
niveau
de
visibilité
pouvoir
être
masquer
:

public

privé

protéger
10:11:29
programmation
web
2011-2012
4

encapsulation

donnée
internes
objet
être
appeler
attribut

fonctionnalité
objet
être
appeler
méthode

méthode
habituelles
:

constructeur
/
destructeur

accesseurs
/
modificateurs
(getters
/
setters)

référence
à
l’objet
courir
dans
description
de
classe
:
$this
10:11:29
programmation
web
2011-2012
5

visibilité

publique
:
donnée
internes
méthode
être
accessibles
par

protéger
:
donnée
internes
méthode
être
accessibles
objet
dériver

privé
:
donnée
internes
méthode
être
accessibles
qu’aux
objet
de
classe
10:11:29
programmation
web
2011-2012
6

héritage
dérivation
extension

création
de
nouvelles
classe
à
partir
modèle
d’une
classe
existante

nouvelle
classe
posséder
attribut
méthode
de
classe
mère

nouvelle
classe
pouvoir
proposer
de
nouveaux
attribut
de
nouvelles
méthode
spécialiser
méthode
mammifère
de
classe
mère
herbivore
impala
10:11:29
caribou
carnivore
guépard
programmation
web
2011-2012
léopard
7

polymorphisme
mammifère
nourriture

choix
dynamique
de
méthode
correspondre
type
réel
de
l’objet

méthode
mange()
herbivore
plante
impala
herber
caribou
mousse
carnivore
viande
guépard
impala
léopard
impala

function
nourriture(mammifere
$m)
{
return
$m->mange()
;
}

$i
=
new
impala()
;
nourriture($i)
;

$c
=
new
carnivore()
;
nourriture($c)
;
10:11:29
programmation
web
2011-2012
herbe
viande
8

développement
objet
en
php

php
4

classe
(tout
être
public)

constructeur

héritage

méthode
statiques
implicites

outil
pour
linéarisation
(sauvegarde
sur
disque)

php
5

classe
(choix
public,
protected,
private)

constructeur
destructeur

membre
méthode
statiques

classe
méthode
abstraire

…
10:11:29
programmation
web
2011-2012
9

déclaration
définition
d'une
classe
en
phpde4classe
<?php
macler
{
var
$madonnee
;
//
attribut
attribut
public
constructeur
public
référence
à
//
constructeur
l'objet
courir
function
maclasse($param)
{
$this->madonnee
=
$param
;
}
accès
à
attribut
function
affiche()
{
//
méthode
echo
get_class($this)
méthode
publique
."
contenir
".$this->madonnee
;
}
donner
nom
de
classe
de
l'objet
courir
}
?>
10:11:29
programmation
web
2011-2012
10

utilisation
d'une
classe
en
php
4
inclusion
de
définition
de
classe
<?php
require
"maclasse.php"
;
création
d'un
objet
//
nouvel
objet
$o
=
new
maclasse(12)
macler
contenir
12
;
//
utilisation
d'une
méthode
$o->affiche()
;
$o->madonnee
=
"coucou"
;
méthode
affiche
de
l'objet
$o
impossible
de
restreindre
l'accès
attribut
?>
10:11:29
programmation
web
2011-2012
11

héritage
en
php
4
héritage
de
macler
<?php
maclasseheritee
extends
macler
{
var
$autredonnee
;
function
maclasseheritee($param1,
$param2)
{
opérateur
de
parent::maclasse($param1)
;
résolution
de
portée
$this->autredonnee
=
$param2
;
(paamayim
}
nekudotayim)
function
affiche()
{
maclasse::affiche()
;
méthode
macler
echo
"
".get_class($this)
parent
."
contenir
".$this->autredonnee
;
}
}
méthode
affiche
de
?>
classe
macler
10:11:29
programmation
web
2011-2012
12

méthodes
de
classe
implicites
<?php
macler
{
var
$madonnee
;
//
attribut
//
constructeur
function
maclasse($param)
{
$this->madonnee
=
$param
;
}
function
affiche()
{
//
méthode
echo
$this->madonnee
;
}
function
statique()
{
//
méthode
echo
"statique!!!
!!!"
;
}
}
?>
10:11:29
programmation
web
2011-2012
méthode
publique
faire
référence
à
$this

méthode
statique
(méthode
de
classe)
13

méthodes
de
classe
implicites
inclusion
de
définition
de
classe
<?php
require
"maclasse.php"
;
création
d'un
objet
//
création
d'un
objet
$o
=
new
maclasse(12)
;
méthode
affiche
de
l'objet
$o
//
utilisation
d'une
méthode
12
$o->affiche()
;
impossible
de
restreindre
l'accès
//
utilisation
d'une
méthode
auxstatique
attribut
maclasse::statique()
;
statique!!!
!!!
?>
10:11:29
programmation
web
2011-2012
14

développement
objet
en
php
5
a
partir
de
maintenant,
développement
en
php
5
10:11:29
programmation
web
2011-2012
15

définition
d'une
classedéclaration
de
classe
<?php
macler
{
private
$madonnee
;
attribut
privé
constructeur
public
public
function
__construct($param)
{
$this->madonnee
=
$param
;
référence
à
l'objet
}
courir
function
__destruct()
{
echo
"destruction..."
;
}
destructeur
public
function
affiche()
{
echo
"madonnee
:
"
méthode
publique
.$this->madonnee
;
par
défaut
}
}
?>
accès
à
attribut
10:11:29
programmation
web
2011-2012
16

utilisation
d'une
classe
inclusion
de
définition
de
classe
<?php
require
"maclasse.php"
;
création
d'un
objet
//
nouvel
objet
$o
=
new
maclasse(12)
macler
contenir
12
;
//
utilisation
d'une
méthode
$o->affiche()
;{
fatal
macler
error:
cannot
access
private
private
$madonnee
;
property
maclasse::$madonnee
in
...
dummy.php
=line
25
$o->madonnee
"coucou"
;
function
__destruct()
{
destruction...
echo
"destruction..."
;
}
unset($o)
;
?>
10:11:29
programmation
web
2011-2012
méthode
affiche
de
l'objet
$o
l'attribut
être
priver
destruction
de
l'objet
$o
17

valeur
par
défaut
attribut
attribut
avec
valeur
par
défaut
<?php
macler
{
private
$madonnee
=
"défaut"
;
function
affecte($val)
{
$this->madonnee
=
$val
;
}
function
affiche()
{
nouvel
objet
echo
"madonnee
:
".$this->madonnee
;
}
}
affichage
madonnee
:
défaut
$o
=
new
maclasse()
;
affectation
$o->affiche()
;
madonnee
:
nouvelle
$o->affecte("nouvelle")
;
affichage
$o->affiche()
;
?>
10:11:29
programmation
web
2011-2012
18

attributs
méthode
de
classe

mot
clé
static

attribut
méthode
utilisables
sans
instance
de
classe
(=attributs
méthode
de
classe)

attribut
pouvoir
être
accéder
depuis
instance
($objet->attribut)

attribut
partager
par
instance
de
classe

méthode
pouvoir
être
accéder
depuis
instance
($objet->methode())

dans
méthodes,
$this
n'est
disponible
10:11:29
programmation
web
2011-2012
19

attributs
statiques
attribut
privé
statique
:
pouvoir
être
accéder
par
méthode
de
classe
macler
{
private
static
$n
=
0
;
function
__construct()
{
accès
à
l'attribut
statique
echo
++maclasse::$n
."
instance(s)"
;
}
function
__destruct()
{
echo
"destruction"
;
self::$n--
;
}
1
instance(s)
}
instance(s)
2
$s
=
new
maclasse()
;
destruction
$tinstance(s)
=
new
maclasse()
;
2
unset($t)
;
cannot
access
private
property
3
instance(s)
fatal
error:
$u
=
new
maclasse()
;
maclasse::$n
in
dummy.php
line
37
$v
=
new
maclasse()
;
10:11:29
programmation
web
2011-2012
20

méthodes
statiques
macler
{
private
static
$n
=
0
;
function
__construct()
{
echo
++maclasse::$n."
instance(s)<br>\n"
;
}
méthode
publique
statique
function
__destruct()
{
maclasse::$n--
;
}
static
function
f($i)
{
echo
"dans
f()
:
".($i*$i)appel
;
}
à
partir
d'une
instance
}
instance(s)
tolérer
1
dans
f()
:
4
$s
=
f()
new
:
maclasse()
;
dans
9
$s->f(2)
;
maclasse::f(3)programmation
;
10:11:29
web
2011-2012
appel
sans
instance
21

constantes
de
classe
macler
{
const
constante
=
"valeur"
;
public
function
montre()
{
echo
self::constante
;
}
}
valeur
$c
=
new
maclasse()
;
valeur
$c->montre()
;
echo
maclasse::constante
;
10:11:29
programmation
web
2011-2012
constante
publique
de
classe
accès
à
constante
de
classe
depuis
classe
accès
à
constante
de
classe
à
l'extérieur
de
classe
22

héritage
simple
{
function
affiche()
{
echo
"je
suis
simple"
;
}
}
etendue
extends
simple
{
function
affiche()
{
parent::affiche()
;
echo
"
etendue"
;
}
}
$s
=
new
simple()
;
$e
=
new
etendue()
;
suis
simple;
$s->affiche()
$e->affiche()
suis
simple;mais
etendue
10:11:29
programmation
web
2011-2012
classe
simple
méthode
publique
classer
étendre
hériter
de
classe
simple
surcharger
de
méthode
appel
de
méthode
parent
23

assignation
d'objets
{
private
$_x
;
private
$_y
;
public
function
__construct($x=0,
$y=0)
{
$this->_x
=
$x
;
$this->_y
=
$y
;
}
public
function
set($x,
$y)
{
$this->_x
=
$x
;
$this->_y
=
$y
;
}
public
function
tostring()
{
return
"({$this->_x},
{$this->_y})"
;
}
10:11:29
programmation
web
2011-2012
24

assignation
d'objets
$segment
=
array()
;
$point
=
new
point()
;
for
($i=10;
$i<20;
$i++)
{
$point->set($i,
$i)
;
$segment[]
=
$point
;
}
foreach
($segment
avoir
$k
=>
$p)
echo
"$k:
{$p->tostring()}<br>\n"
;
10:11:29
programmation
web
2011-2012
$point
$segment
0:
(19,
19)
0
1:
(19,
19)
1
19)
2:
(19,
2
19)
3:
(19,
4:
(19,
3
19)
5:
(19,
4
19)
6:
(19,
5
19)
7:
(19,
19)
6
8:
(19,
19)
7
19)
9:
(19,
8
9
19,19
18,18
17,17
16,16
15,15
14,14
13,13
12,12
11,11
10,10
0,0
25

19,19
18,18
17,17
16,16
15,15
14,14
13,13
12,12
11,11
10,10
0,0
clonage
d'objets
$segment
=
array()
;
$point
=
new
point()
;
for
($i=10;
$i<20;
$i++)
{
$point->set($i,
$i)
;
$segment[]
=
cloner
$point
;
}
foreach
($segment
avoir
$k
=>
$p)
echo
"$k:
{$p->tostring()}<br>\n"
;
$point
$segment
0:
(10,
10)
0
1:
(11,
11)
1
12)
2:
(12,
2
13)
3:
(13,
4:
(14,
3
14)
5:
(15,
4
15)
6:
(16,
5
16)
7:
(17,
17)
6
8:
(18,
18)
7
19)
9:
(19,
8
9
10,10
11,11
12,12
13,13
14,14
15,15
16,16
17,17
18,18
19,19
10:11:29
programmation
web
2011-2012
26

objets
argument
de
fonction
function
origine($p)
{
$p->set(0,
0)
;
}
$point
=
new
point(10,
10)
;
echo
"avant:
{$point->tostring()}<br>\n"
;
origine($point)
;
echo
"apres:
{$point->tostring()}<br>\n"
;
passage
de
l'objet
avant:
(10,
10)
point
par
référence
apres:
(0,
0)
10:11:29
programmation
web
2011-2012
27

objets
dans
chaîne
de
caractère

problème
:

ambiguïté

évaluable

chaîne
contenir
:

attribut
d'un
objet
dans
chaîne
"a
:
$a->attribut"

résultat
d'une
méthode
d'un
objet
dans
chaîne
"résultat
:
$a->calcule()"

entrée
de
tableau
associatif

"valeur
:
$tab['cle']"

variableprogrammation
suivre
de
texte
(sans
espace)
10:11:29
web
2011-2012
28

objets
dans
chaîne
de
caractère

solution
:

effectuer
concaténation
(pénible)

délimiter
par
{
}

chaîne
contenir
:

attribut
d'un
objet
dans
chaîne
"a
:
{$a->attribut}"

résultat
d'une
méthode
d'un
objet
dans
chaîne
"résultat
:
{$a->calcule()}"

entrée
de
tableau
associatif

"valeur
:
{$tab['cle']}"

variableprogrammation
suivre
de
texte
(sans
espace)
10:11:29
web
2011-2012
29

gestion
erreur
:
exception

gestion
exception
identiques
à
c++/java

exception
pouvoir
être
:

jetée
:
throw

essayer
:
try

capturer
:
catch

exception
jeter
:
code
après
throw
exécuter

capture
:
1
bloc
(selon
type)

exception
capturer
:
erreur
fatale
10:11:29
programmation
web
2011-2012
30

utilisation
exception
try
{
$error
=
'toujours
lancer
erreur';
déroutement
throw
new
exception($error);
/*
code
après
exception
n'est
capturer
essayer
lancer
exécuté.
*/
echo
'jamais
exécuté';
}
capturer
exception:
lancer
erreur
catch
(exception
$e)
{
echo
"capture
exception:
"
.$e->getmessage()."
\n";
}
bonjour
monde
//
poursuite
de
l'exécution
echo
'bonjour
monde';
10:11:29
programmation
web
2011-2012
31

classe
exception
php
5
<?php
exception
{
protected
$message
=
'';
//
message
de
l'exception
protected
$code
=
0;
//
code
de
l'exception
protected
$file;
//
fichier
source
de
l'exception
protected
$line;
//
ligne
de
source
de
l'exception
function
__construct(string
$message=null,
int
code=0);
final
final
final
final
final
final
function
function
function
function
function
function
function
getmessage();
//
message
de
l'exception
getcode();
//
coder
de
l'exception
getfile();
//
nom
fichier
source
getline();
//
ligner
fichier
source
gettrace();
//
tableau
de
backtrace()
gettraceasstring();
//
chaîne
de
trace
_tostring();
//
chaîne
pour
l'affichage
}
?>
10:11:29
programmation
web
2011-2012
32

pdo

pdo
:
php
dater
objects

extension
php
fournir
interface
pour
accéder
à
base
de
donnée

fournir
interface
d'abstraction
pour
l'accès
donnée

fournir
abstraction
de
base
de
donnée

sql
spécifique
moteur

fonctionnalité
présentes
/
absentes

interface
orienter
objet
20:39:03
programmation
web
2013-2014
1

nom
driver
base
de
donnée
supporter
base
de
donnée
supporter
pdo_dblib
freetds
/
microsoft
sql
server
/
sybase
pdo_firebird
firebird/interbase
6
pdo_ibm
ibm
db2
pdo_informix
ibm
informix
dynamic
server
pdo_mysql
mysql
3.x/4.x/5.x
pdo_oci
oracle
call
interface
pdo_odbc
odbc
v3
(ibm
db2,
unixodbc
win32
odbc)
pdo_pgsql
postgresql
pdo_sqlite
sqlite
3
sqlite
2
pdo_4d
4d
20:39:03
programmation
web
2013-2014
2

20:39:03
programmation
web
2013-2014
3

classes
prédéfinies

pdo
:
connexion
php
/
base
de
données

__construct()

exec(),
prepare(),
query()

errorcode(),
errorinfo()

getattributes(),
setattribute()

lastinsertid(),
quote()

begintransaction()

commit(),
rollback()

getavailabledrivers()
20:39:03
programmation
web
2013-2014
4

classes
prédéfinies

pdostatement
:
requêter
préparée,
jeu
de
résultat

bindcolumn(),
bindparam(),
bindvalue(),
closecursor()

errorcode(),
errorinfo()

fetch(),
fetchall(),
fetchcolumn(),
fetchobject(),




setfetchmode(),
nextrowset()
rowcount(),
columncount(),
getcolumnmeta()
getattribute(),
setattribute()
execute()
debugdumpparams()
20:39:03
programmation
web
2013-2014
5

20:39:03
programmation
web
2013-2014
6

connexions
gestionnaire
de
connexion

instanciation
d'un
objet
pdo

$dbh=new
pdo(dsn
[,
user
[,
pass
[,
options]]]);

dsn
:
dater
source
name

nom_du_driver:syntaxe_spécifique_au_driver

:
mysql:host=localhost;dbname=ma_base

user
:
nom
d'utilisateur,
pass
:
mot
de
passe

option
:
tableau
associatif

spécifiques
driver

:
array(pdo::attr_persistent
=>
true))
;

fin
de
connexion
:
$dbh=null
;
unset($dbh)
;
20:39:03
programmation
web
2013-2014
7

20:39:03
programmation
web
2013-2014
8

gestion
erreur
de
connexion

connexion
par
construction
d'un
objet

gestion
envisageable
erreur


fin
brutale
(exit,
die)

état

exception

en
cas
d'erreur
de
connexion

objet
pdoexception
lancer

pdoexception
hériter
de
exception
20:39:03
programmation
web
2013-2014
9

gestion
erreur
de
connexion
<?php
try
{
$dbh
=
new
pdo('mysql:host=h;dbname=db',
$user,
$pass)
;
…
$dbh
=
null
;
}
catch
(pdoexception
$e)
{
echo
"erreur:
".$e->getmessage()."<br/>"
;
die()
;
}
?>
20:39:03
programmation
web
2013-2014
10

gestion
erreur
(hormis
connexion)

pdo::errmode_silent
(par
défaut)

mode
silencieux,
mettre
en
place
d'un
coder
d'erreur

pdo
:
errorcode()
/
errorinfo()

pdostatement
:
errorcode()
/
errorinfo()

pdo::errmode_warning

mettre
en
place
code
d'erreur

émission
d'une
erreur
de
type
e_warning

pdo::errmode_exception

mettre
en
place
code
d'erreur

objet
pdoexception
lancer
20:39:03
programmation
web
2013-2014
11

gestion
erreur
(hormis
connexion)
<?php
try
{
$dbh
=
new
pdo('mysql:host=h;dbname=db',
$user,
$pass)
;
$dbh->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
…
$dbh
=
null
;
}
catch
(pdoexception
$e)
{
echo
"erreur:
".$e->getmessage()."<br/>"
;
die()
;
}
20:39:03
programmation
web
2013-2014
12

gestion
erreur
:
coder
d'erreur
<?php
$pdo
=
new
pdo("mysql:host=localhost")
;
$pdostat
=
$pdo->query("coucou")
;
code
sqlstate
if
($pdo->errorcode())
{
echo
"erreur!!
!!\n"
;
echo
"<pre>\n"
;
coder
erreur
spécifique
var_dump($pdo->errorinfo())
;
driver
echo
"</pre>\n"
;
erreur!!
!!
}
array(3)
{
chaîne
erreur
spécifique
[0]=>
string(5)
"42000"
driver
[1]=>
int(1064)
[2]=>
string(47)
"erreur
de
syntaxe
de
'coucou'
à
ligne
1"
}
20:39:03
programmation
web
2013-2014
13

gestion
erreur
:
exception
<?php
try
{
$pdo
=
new
pdo("mysql:host=localhost")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception)
coder
erreur
;
spécifique
driver
$pdostat
=
$pdo->query("coucou")
;
}
catch
coder
(exception
$e)
{
chaîne
erreur
spécifique
sqlstate
driver
echo
"erreur
:
".$e->getmessage()
;
}
erreur
:
sqlstate[42000]:
syntax
error
access
violation:
1064
erreur
de
syntaxe
de
'coucou'
à
ligne
1
20:39:03
programmation
web
2013-2014
14

20:39:03
programmation
web
2013-2014
15

exécution
d'une
requêter

pdostatement
pdo::query
(
string
statement
)
résultat
de
requête
requêter
<?php
try
{
$pdo
=
new
pdo("mysql:host=localhost")
;
$pdostat
=
$pdo->query("select
*
from
clients")
;
}
catch
(exception
$e)
{
echo
"erreur
:
".$e->getmessage()
;
}
20:39:03
programmation
web
2013-2014
16

exploitation
résultat
d'une
requêter

récupération
données
ligne
à
ligne

ligne
pouvoir
être
:

tableau
indexer

tableau
associatif

tableau
mixte
(par
défaut)

objet
anonyme

objet
d'une
classe
définir
par
l'utilisateur

récupération
donnée
d'une
colonne
20:39:03
programmation
web
2013-2014
17


parcourir
résultat
de
requête
parcourir
résultat
d'une
requête
select
*
résultat
de
requête
from
morceau
order
by
mor_id
curseur
interne
+--------+------------------------------------+
|
mor_id
|
mor_nom
|
+--------+------------------------------------+
|
872
|
with
a
little
help
from
my
friends
|
|
873
|
the
letter
|
|
874
|
marjorine
|
|
875
|
midnight
rider
|
|
876
|
you
are
so
beautiful
|
|
877
|
feelin'
allright
|
|
878
|
cry
me
a
river
|
...
20:39:03
programmation
web
2012-2013
18

exploitation
résultat
d'une
requêter
(1)
try
{
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->query("select
name
from
user")
;
$pdostat->setfetchmode(pdo::fetch_assoc)
;
foreach
($pdostat
avoir
$ligne)
{
echo
"<p>"
.
$ligne['name']
.
"\n"
;
}
}
catch
(exception
$e)
{
echo
"erreur
:
".$e->getmessage()
;
}
20:39:03
programmation
web
2013-2014
19

exploitation
résultat
d'une
requêter
(2)
try
{
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->query("select
name
from
user")
;
foreach
($pdostat->fetchall(pdo::fetch_assoc)
avoir
$ligne)
{
echo
"<p>"
.
$ligne['name']
.
"\n"
;
}
}
catch
(exception
$e)
{
echo
"erreur
:
".$e->getmessage()
;
}
20:39:03
programmation
web
2013-2014
20

exploitation
résultat
d'une
requêter
(3)
try
{
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->query("select
name
from
user")
;
while
($ligne
=
$pdostat->fetch(pdo::fetch_assoc))
{
echo
"<p>"
.
$ligne['name']
.
"\n"
;
}
}
catch
(exception
$e)
{
echo
"erreur
:
".$e->getmessage()
;
}
20:39:03
programmation
web
2013-2014
21

modes
de
récupération
donnée
(1)

pdo::fetch_assoc

retourner
ligne
dans
tableau
indexer
par
nom
colonne
être
retourner
dans
jeu
de
résultat
correspondant.
jeu
de
résultat
contenir
de
multiples
colonne
avec
même
nom,
pdo::fetch_assoc
retourner
seule
valeur
par
nom
de
colonne.

pdo::fetch_num

retourner
ligne
dans
tableau
indexer
par
numéro
colonne
être
retourner
dans
jeu
de
résultat
correspondant,
en
commencer
à
20:39:03
programmation
web
2013-2014
22

modes
de
récupération
donnée
(2)

pdo::fetch_both
(par
défaut)

retourner
ligne
dans
tableau
indexer
par
nom
colonne
numéros,
être
retourner
dans
jeu
de
résultat
correspondant,
en
commencer
à

pdo::fetch_obj

retourner
ligne
dans
objet
avec
nom
de
propriété
correspondre
nom
colonne
être
retourner
dans
jeu
de
résultats.
20:39:03
programmation
web
2013-2014
23

modes
de
récupération
donnée
(3)

pdo::fetch_bound

retourner
true
assigner
valeur
colonne
jeu
de
résultat
dans
variables
php
être
lier
avec
méthode
pdostatement::bindparam()
méthode
pdostatement::bindcolumn().

pdo::fetch_class
|
pdo::fetch_classtype

retourner
nouvelle
instance
de
classe
demandée,
lier
colonne
propriété
nommer
dans
classe.
nom
de
classe
=
1ère
colonne.
20:39:03
programmation
web
2013-2014
24

modes
de
récupération
donnée
(4)

pdo::fetch_into

mettre
à
jour
instance
existante
de
classe
demandée,
lier
colonne
jeu
de
résultat
nom
propriété
de
classe.

pdo::fetch_lazy

retourner
ligne
en
qu'objet
avec
nom
attribut
correspondre
nom
colonne
retourner
dans
jeu
de
résultats.

pdo::fetch_lazy
créer
nom
attribut
de
l'objet
être
rencontrés.
20:39:03
programmation
web
2013-2014
25

exemple
avec
pdo::fetch_class
$stmt
=
$pdo->query(<<<sql
select
id,
name
from
artist
where
id
=
12
sql
)
;
$stmt->setfetchmode(pdo::fetch_class,
'artist')
;
if
(($object
=
$stmt->fetch())!
!==
false)
{
return
$object
;
instancie
objet
de
classe
artist
}
attribut
être
supposer
être
id
name
20:39:03
programmation
web
2013-2014
26

préparation
d'une
requêter

déroulement
d'une
requête
sql
1.
2.
3.




analyser
compilation
optimisation
exécution
exécution
répéter
d'une
requête
:
1+2+3+4
préparation
d'une
requête
:
1+2+3
exécution
répéter
d'une
requêter
préparer
:
4
préparation
en
fonction
de
paramètre
:


20:39:03
anonyme
nommer
programmation
web
2013-2014
27

20:39:03
programmation
web
2013-2014
28

préparation
d'une
requêter

pdostatement
pdo::prepare(string
statement
[,
array
driver_options])

statement
:
requête
à
préparer.
pouvoir
contenir
paramètre
anonymes
(?)
nommés
(:nom)

driver_options
:
tableau
d'options
driver

retourner
objet
pdostatement
effectuer
l'association
paramètre
exécuter
requête
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdostat
=
$pdo->prepare(
"select
*
from
user
where
user=
?")
;
20:39:03
programmation
web
2013-2014
29

association
paramètre
d'une
requête

bool
pdostatement::bindvalue(mixed
parameter,
mixed
valoir
[,
int
data_type])

parameter
:
paramètre
(nom
position
[1…n])

value
:
valeur

data_type
:
type
de
valeur

pdo::param_bool
booléen.

pdo::param_null
null
sql.

pdo::param_int
integer
sql.

pdo::param_str
char,
varchar
autre
chaîne.

pdo::param_lob
"objet
large"
sql.

bool
pdostatement::execute([array
parameters])

parameters
:
tableau
associatif
indexer
valeur
20:39:03
programmation
web
2013-2014
30

préparation
exécution
d'une
requêter
(1)
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->prepare(
"select
*
from
user
where
user=
?")
;
paramètre
anonyme
$pdostat->bindvalue(1,
'root')
;
$pdostat->execute()
;
//
utilisation
résultat
$pdostat->bindvalue(1,
'cutrona')
;
$pdostat->execute()
;
//
utilisation
résultat
association
préparation
d'une
valeur
valeur
delalarequête
requête
1er
paramètre
association
exécution
d'une
de
1er
paramètre
20:39:03
programmation
web
2013-2014
31

préparation
exécution
d'une
requêter
(2)
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->prepare(
"select
*
from
user
where
user=
:utilisateur")
;
paramètre
nommer
$pdostat->bindvalue(':utilisateur',
'root')
;
$pdostat->execute()
;
//
utilisation
résultat
$pdostat->bindvalue(':utilisateur',
'cutrona')
;
$pdostat->execute()
;
//
utilisation
résultat
association
préparation
exécution
d'une
valeur
de
dela
larequête
requêter
paramètre
nommer
20:39:03
programmation
web
2013-2014
32

préparation
exécution
d'une
requêter
(3)
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->prepare(
"select
*
from
user
paramètre
where
user=
?")
;
anonyme
$pdostat->execute(array('root'))
;
//
utilisation
résultat
$pdostat->execute(array('cutrona'))
;
//
utilisation
résultat
association
association
préparation
exécution
d'une
d'une
valeur
valeur
de
delalarequête
requête
1er
1er
paramètre
paramètre
20:39:03
programmation
web
2013-2014
33

préparation
exécution
d'une
requêter
(4)
$pdo=new
pdo("mysql:host=localhost;dbname=mysql")
;
$pdo->setattribute(pdo::attr_errmode,
pdo::errmode_exception);
$pdostat
=
$pdo->prepare(
"select
*
from
user
where
user=
:utilisateur")
paramètre
nommer
;
$pdostat->execute(
array(':utilisateur'
=>
'root'))
;
//
utilisation
résultat
$pdostat->execute(
array(':utilisateur'
=>
'cutrona'))
;
//
utilisation
résultat
association
préparation
exécution
d'une
valeur
de
dela
larequête
requêter
paramètre
nommer
20:39:03
programmation
web
2013-2014
34

intérêt
requête
préparer

amélioration
performance
en
cas
d'exécutions
répéter

émulation
faire
par
pdo
driver
supporter

protection
automatique
valeur
paramètre
pour
interdire
attaque
par
injection
de
code
sql
20:39:03
programmation
web
2013-2014
35

20:39:03
programmation
web
2013-2014
36

attaque
par
injection
sql
?

:
validation
d'un
login/pass
sur
site

requête
consister
à
trouver
enregistrement
correspondre
couple
login/pass
fournir
par
l'utilisateur

select
*
from
membrer
where
login='{$_get['login']}'
and
passwd='{$_get['passwd']}'

essayer
de
fournir
mot
de
passe
particulier…
20:39:03
programmation
web
2013-2014
37

exemple
concret
d'injection
sql
(1)
$pdo
=
new
pdo('mysql:host=localhost;dbname=test')
;
$pdostat
=
$pdo->query($req
=
<<<sql
select
*
from
membrer
where
login='{$_get['login']}'
and
passwd='{$_get['passwd']}'
sql
)
;
echo
"requête:\n$req\n"
;
if
($utilisateur
=
$pdostat->fetch())
echo
"bienvenue
{$utilisateur['nom']}"
;
else
echo
"désolé..."
;
20:39:03
programmation
web
2013-2014
38

exemple
concret
d'injection
sql
(2)
saisir
de
l'utilisateur
par
formulaire
:

mail
:
whatever

pass
:
who_cares?
url
:
?mail=whatever&passwd=who_cares?
requête:
select
*
from
membrer
where
login='whatever'
and
passwd='who_cares?'
désolé...
20:39:03
programmation
web
2013-2014
39

exemple
concret
d'injection
sql
(3)
saisir
de
l'utilisateur
:

mail
:
whatever

pass
:
who_cares?'
true!
!='
url
:
?mail=whatever&passwd=who_cares?'%20or%20true!
!='
requête:
select
*
from
membrer
where
login='whatever'
and
passwd='who_cares?'
true!
!=''
bienvenir
john
20:39:03
programmation
web
2013-2014
40

protection
contre
injection
sql
(1)
$pdo
=
new
pdo('mysql:host=localhost;dbname=test')
;
$pdostat
=
$pdo->prepare($req
=
<<<sql
select
*
from
membrer
where
login=?
and
passwd=?
sql
)
;
$pdostat->execute(array($_get['login'],
$_get['passwd']))
;
if
($utilisateur
=
$pdostat->fetch())
{
echo
"bienvenue
{$utilisateur['nom']}\n"
;
}
else
{
echo
"désole...\n"
;
}
20:39:03
programmation
web
2013-2014
41

protection
contre
injection
sql
(2)
$pdo
=
new
pdo('mysql:host=localhost;dbname=test')
;
$login
=
$pdo->quote($_get['login'])
;
$passwd
=
$pdo->quote($_get['passwd'])
;
$pdostat
=
$pdo->query($req
=
<<<sql
select
*
from
membrer
requête:
where
login=$login
select
*
and
passwd=$passwd
from
membrer
sql
where
login='whatever'
)
;
and
passwd='who_cares?\'
or
true!
!=\''
echo
"requête:\n$req\n"
;
désolé...
if
($utilisateur
=
$pdostat->fetch())
{
echo
"bienvenue
{$utilisateur['nom']}\n"
;
}
42
20:39:03
programmation
web
2013-2014


